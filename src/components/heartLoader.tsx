'use client'

import { useEffect, useState } from 'react'
import { usePulse } from './usePulse'

export default function HeartLoader({ pulseKey }: { pulseKey: number }) {
	const [state, setState] = useState<number>(0)
	const { subscribe, unsubscribe } = usePulse(1200, 600)
	const fillOn = '#FEF'
	const fillOff = '#112'
	const classOn = 'absolute top-0 animate-[dropShadow_1s_infinite]'
	const classOff = 'absolute top-0 -z-10'

	function onPulse() {
		setState(prev => (prev + 1) % 3)
	}

	useEffect(() => {
		subscribe(pulseKey, onPulse)
		return () => {
			unsubscribe(pulseKey)
		}
	}, [])

	return (
		<div className="relative w-full animate-[flicker_2s_ease_infinite]">
			<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="-4 18 618 508" className="p-1">
				{state === 0 && (
					<path
						fill={state === 0 ? fillOn : fillOff}
						className={state === 0 ? classOn : classOff}
						d="M433.601,67.001c-24.7-24.7-57.4-38.2-92.3-38.2s-67.7,13.6-92.4,38.3l-12.9,12.9l-13.1-13.1
		c-24.7-24.7-57.6-38.4-92.5-38.4c-34.8,0-67.6,13.6-92.2,38.2c-24.7,24.7-38.3,57.5-38.2,92.4c0,34.9,13.7,67.6,38.4,92.3
		l187.8,187.8c2.6,2.6,6.1,4,9.5,4c3.4,0,6.9-1.3,9.5-3.9l188.2-187.5c24.7-24.7,38.3-57.5,38.3-92.4
		C471.801,124.501,458.301,91.701,433.601,67.001z M414.401,232.701l-178.7,178l-178.3-178.3c-19.6-19.6-30.4-45.6-30.4-73.3
		s10.7-53.7,30.3-73.2c19.5-19.5,45.5-30.3,73.1-30.3c27.7,0,53.8,10.8,73.4,30.4l22.6,22.6c5.3,5.3,13.8,5.3,19.1,0l22.4-22.4
		c19.6-19.6,45.7-30.4,73.3-30.4c27.6,0,53.6,10.8,73.2,30.3c19.6,19.6,30.3,45.6,30.3,73.3
		C444.801,187.101,434.001,213.101,414.401,232.701z"
					/>
				)}
				{state === 1 && (
					<path
						fill={state === 1 ? fillOn : fillOff}
						className={state === 1 ? classOn : classOff}
						d="M308.07860455 193.1156546C329.1674249 176.2482308 329.09504175 153.8969083 328.9478336 150.42193675 327.88554855 125.34575785 318.34595235 99.495038 302.74926145 79.8306922 284.2736148 56.53654915 261.19278505 38.1674241 228.3902606 30.571796 195.6491839 22.99039925 161.84747195 28.02899795 133.1815509 45.5518121 104.3991036 63.14586695 84.20274694 90.85814155 76.392271445 123.6447593 68.487913935 156.4087288 73.94332694 190.21017795 91.53737595 218.99263255l133.7717408 218.83988545c1.85201 3.0296825 4.82071195 5.136718 8.01261505 5.9067585 3.19190675 0.770077 7.164293-0.576919 10.59285845-1.5010625l233.47040675-69.7762105c32.571432-8.779637 59.7525075-29.6854135 76.5609035-58.8990061 16.8922365-29.1653615 21.3886715-63.1230051 12.6091075-95.69442615-8.779637-32.57144295-29.649899-59.6206622-58.863477-76.429029-29.2136145-16.80839965-77.121069-17.6640801-91.4283755-14.7680679-14.035637 2.84101035-20.08074145 9.4860142-22.9881891 25.082508L381.934139 212.5898719 326.1985076 239.4860941c-5.94838675 2.87050235-16.1778147 7.91808005-19.63752925 20.82264045L293.2488553 309.96230525 253.24213605 236.87047125m-18.5468545-18.449947c0 0-15.7658611 9.69860115-6.29802025 26.85764535l45.4957024 82.454157c0 0 10.55332165 14.7033534 24.3156649 11.9768764 13.76233595-2.7265135 16.605164-17.3361714 16.605164-17.3361714L331.4837003 265.91247735 394.0838064 236.836143c5.39444815-2.5056009 11.3643553-6.90018995 12.4939135-12.7399016l13.1331526-67.8969496c2.1495945-11.11321705 55.0286045-4.6601813 74.893328 7.79286315 22.583426 14.15736815 39.6652435 34.85489755 46.6802515 60.61734215 6.9667915 25.8461683 3.401435 52.76314805-9.939315 75.9498789-13.2569095 23.2349656-34.819394 39.7971545-60.6655185 46.7639825L240.6825335 413.228379 113.67772115 205.4587647C99.7164529 182.6192255 95.46608995 155.7645184 101.73974645 129.75987805c6.27366015-26.004644 22.2074103-47.9899372 45.0242684-61.85731285 22.72299105-13.8900531 49.6197206-18.3120135 75.48847875-11.88940415 25.7965429 6.40465865 51.9708097 23.8187612 64.77823995 45.3315181 6.4037133 10.7563748 13.83405115 23.52437045 15.39912005 45.2192879 1.0723627 14.8650484-9.0702573 25.92115755-9.0702573 25.92115755"
					/>
				)}
				{state === 2 && (
					<path
						fill={state === 2 ? fillOn : fillOff}
						className={state === 2 ? classOn : classOff}
						d="m 427.94585,271.84235 c 26.88262,-2.56385 39.06273,-21.30504 40.84262,-24.29319 12.84411,-21.56321 19.01935,-48.41708 16.73863,-73.41191 C 482.82537,144.52868 473.57326,116.5189 450.28685,92.199321 427.04405,67.925301 396.00249,53.62968 362.42113,52.592318 328.70325,51.550747 296.6282,63.677336 272.13757,86.832784 247.58079,109.91786 233.63407,141.18748 232.59249,174.90535 l -7.9194,256.36511 c -0.1096,3.54917 2.05518,8.49768 4.6948,10.45054 2.63961,1.95286 9.28675,3.51185 12.65279,4.64273 l 96.54741,30.48203 c 6.83216,2.15704 11.45009,5.17088 19.95484,5.17632 l 95.79091,0.0609 c 32.63441,8.54254 45.08357,28.97896 78.78092,28.31112 44.46871,-0.88137 57.46534,-13.19614 57.90878,-35.71408 l 0.79194,-40.21746 c 0,0 26.43629,-63.64852 11.43563,-93.83021 -15.00066,-30.18173 -54.40288,-57.44565 -67.91683,-62.96463 -13.25734,-5.4142 -21.97194,-3.23352 -33.03604,8.13707 l -43.15661,44.35204 -37.53506,-6.89521 c -6.49609,-1.19334 -19.01613,-2.18289 -31.7245,1.93955 l -45.01727,15.70155 13.25666,-62.4815 m -5.41423,-25.59439 c 0,0 -16.19257,-0.20576 -19.97816,19.02292 l -14.11165,71.67932 c 0,0 -6.48423,14.00525 5.20813,21.75924 9.20045,6.10142 19.01674,2.65756 27.04224,0.31335 l 61.79641,-18.05024 43.15067,9.52071 c 5.80824,1.28153 13.28354,0.55499 17.4603,-3.67976 l 48.56196,-49.23623 c 7.94853,-8.05887 51.00882,25.62188 58.01956,47.99455 11.48235,36.64258 -12.23389,52.45564 -13.87609,83.02377 0,0 0.69116,30.78888 -0.45457,37.41987 -1.25232,7.24784 -20.54002,12.74 -32.04022,12.79617 -26.21521,0.12812 -47.42251,-21.67603 -73.31858,-28.45478 l -94.58839,0.45852 -115.06658,-32.2513 8.03704,-249.43641 c 0.82653,-26.7559 11.97716,-51.55317 31.46778,-69.87571 19.49063,-18.322548 44.86275,-27.991736 71.54826,-27.099069 26.61939,0.822288 51.54578,11.852347 69.67306,31.393189 18.07668,19.48627 30.44011,48.3911 29.37476,73.40497 -0.53267,12.50694 -1.30801,27.25924 -11.8797,46.26867 -7.24357,13.02499 -21.78484,16.72114 -21.78484,16.72114"
					/>
				)}
			</svg>
		</div>
	)
}
